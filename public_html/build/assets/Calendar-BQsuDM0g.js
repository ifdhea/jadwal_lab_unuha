import{u as Ce,r as w,j as e,H as Te,a as D}from"./app-BsRi02Wf.js";import{A as ee,B as h,U as de}from"./badge-C_t0DFeo.js";import{B as k}from"./button-4wnz9Zqb.js";import{C as A,c as B,a as ae,b as se}from"./card-CtvO2SYM.js";import{C as Ie,D as $e,a as Ae,b as Be,c as Le,d as Je,e as Ee}from"./activity-feed-button-BJ1WYF4g.js";import{L as H}from"./label-CW3bZicJ.js";import{S as Ke,a as Pe,b as He,c as ze,d as Re}from"./select-BiJMe3QD.js";import{C as Oe,T as oe,a as ce,b as z,c as R}from"./tabs-X5AeXQYA.js";import{T as Me}from"./textarea-CQXLHOGr.js";import{t as C,A as Fe}from"./app-layout-CdBpmueg.js";import{C as Ve}from"./calendar-DXPEKcan.js";import{c as he}from"./utils-Cuk0kyiu.js";import{C as O}from"./circle-check-DQIK-M0p.js";import{C as _}from"./clock-CX7qgJh_.js";import{B as me}from"./book-open-DMo6FBlG.js";import{M as xe}from"./map-pin-BEWjHYyS.js";import{P as ue}from"./plus-N0VNghkl.js";import{C as L}from"./circle-x-C3lcXnzp.js";/* empty css            */import"./index-CZi-UQ4q.js";import"./index-C0N98Kzt.js";import"./user-menu-content-CaD6Lgdg.js";import"./index-D-s97nNy.js";import"./index-VkL8W5Kt.js";import"./check-UcFQ4tla.js";import"./building-2-QMJfTkD6.js";import"./users-ezrJfIw7.js";const Ge=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],Ue=he("Inbox",Ge);const Xe=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],Qe=he("Send",Xe);function _a({semesters:pe,selectedSemesterId:M,kampusList:J,mingguList:te,selectedMinggu:v,hari:N,slots:f,jadwalData:ge,myRequests:F,incomingRequests:V,dosenId:We,breadcrumbs:je}){const{flash:y}=Ce().props,[fe,be]=w.useState(J[0]?.kode||"B"),[ve,Ne]=w.useState("calendar"),[we,E]=w.useState(!1),[d,K]=w.useState(null),[o,G]=w.useState(null),[T,U]=w.useState({alasan:""});w.useEffect(()=>{y?.success&&C({title:"Berhasil",description:y.success,variant:"default",className:"bg-green-50 border-green-200 text-green-900",action:e.jsx(O,{className:"h-5 w-5 text-green-600"})}),y?.error&&C({title:"Gagal",description:y.error,className:"bg-red-50 border-red-200 text-red-900",action:e.jsx(L,{className:"h-5 w-5 text-red-600"})})},[y?.success,y?.error]);const ie=a=>{if(!a)return!1;const r=new Date().toISOString().split("T")[0];return a===r},ke=a=>{D.get("/tukar-jadwal/calendar",{semester_id:a,minggu:1},{preserveState:!0})},ne=a=>{const r=Number(a);isNaN(r)||r<1||D.get("/tukar-jadwal/calendar",{semester_id:M,minggu:r},{preserveState:!0,preserveScroll:!0})},re=a=>{!a.is_my_schedule||a.is_past||K(a)},P=(a,r,n)=>{const t=a.length===0,I=a.find(s=>!s.is_my_schedule);if(!d){C({title:"Pilih jadwal Anda dulu",description:"Klik jadwal yang ingin Anda tukar/pindahkan terlebih dahulu",className:"bg-yellow-50 border-yellow-200 text-yellow-900"});return}if(a.some(s=>s.sesi_jadwal_id===d.sesi_jadwal_id))return;if(a.some(s=>s.is_past)){C({title:"Tidak dapat tukar",description:"Tidak dapat tukar dengan jadwal yang sudah lewat",className:"bg-red-50 border-red-200 text-red-900"});return}const b=new Date,c=420,p=b.getTimezoneOffset(),j=new Date(b.getTime()+(c+p)*60*1e3);j.setHours(0,0,0,0);const S=new Date(r+"T00:00:00");if(S.setHours(0,0,0,0),S<j){C({title:"Tidak dapat tukar",description:"Tidak dapat tukar/pindah ke tanggal yang sudah lewat",className:"bg-red-50 border-red-200 text-red-900"});return}G({cell:I||null,isEmptySlot:t,tanggal:r,slot:n}),U({alasan:""}),E(!0)},_e=()=>{if(!d||!o||!T.alasan.trim())return;const a={sesi_jadwal_pemohon_id:d.sesi_jadwal_id,alasan_pemohon:T.alasan};if(!o.isEmptySlot&&o.cell)a.jenis="tukar",a.sesi_jadwal_mitra_id=o.cell.sesi_jadwal_id,a.mitra_id=o.cell.dosen_id;else{a.jenis="pindah",a.sesi_jadwal_mitra_id=null,a.mitra_id=null,a.tanggal_tujuan=o.tanggal,a.minggu_tujuan=v;const r=o.slot.id,n=d.durasi_slot,t=r+n-1;a.slot_tujuan_mulai_id=r,a.slot_tujuan_selesai_id=t,a.lab_tujuan_id=d.laboratorium_id,console.log("Pindah Jadwal - Data yang dikirim:",a)}D.post("/tukar-jadwal",a,{onBefore:()=>{console.log("Request started - Data:",a)},onSuccess:r=>{console.log("Request success:",r),E(!1),K(null),G(null),U({alasan:""})},onError:r=>{console.error("Request error:",r);const n=r?.message||Object.values(r||{}).flat().join(", ")||"Terjadi kesalahan saat mengajukan request";C({title:"Gagal",description:n,className:"bg-red-50 border-red-200 text-red-900",action:e.jsx(L,{className:"h-5 w-5 text-red-600"})})}})},ye=a=>{confirm("Apakah Anda yakin ingin menyetujui pertukaran jadwal ini?")&&D.post(`/tukar-jadwal/${a}/approve`)},Se=(a,r)=>{if(!r.trim()){alert("Harap masukkan alasan penolakan");return}D.post(`/tukar-jadwal/${a}/reject`,{alasan_penolakan:r})},De=a=>{confirm("Apakah Anda yakin ingin membatalkan request ini?")&&D.post(`/tukar-jadwal/${a}/cancel`)},le=a=>{const r={menunggu:{variant:"default",label:"Menunggu",icon:_},disetujui:{variant:"outline",label:"Disetujui",icon:O},ditolak:{variant:"destructive",label:"Ditolak",icon:L},dibatalkan:{variant:"secondary",label:"Dibatalkan",icon:L}},n=r[a]||r.menunggu,t=n.icon;return e.jsxs(h,{variant:n.variant,className:"gap-1",children:[e.jsx(t,{className:"h-3 w-3"}),n.label]})},X=te.find(a=>a.nomor===v);return e.jsxs(Fe,{breadcrumbs:je,children:[e.jsx(Te,{title:"Tukar Jadwal - Kalender"}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Tukar Jadwal"}),e.jsx("p",{className:"text-muted-foreground",children:"Klik jadwal Anda, lalu klik jadwal lain atau slot kosong untuk tukar/pindah"})]}),e.jsx("div",{className:"w-72",children:e.jsxs(Ke,{value:M?String(M):"",onValueChange:ke,children:[e.jsx(Pe,{children:e.jsx(He,{placeholder:"Pilih Semester"})}),e.jsx(ze,{children:pe.map(a=>e.jsx(Re,{value:String(a.id),children:a.nama},a.id))})]})})]}),e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:()=>ne(Number(v)-1),disabled:Number(v)<=1,children:e.jsx(Oe,{className:"h-4 w-4"})}),e.jsxs("div",{className:"text-center min-w-[200px]",children:[e.jsxs("p",{className:"font-semibold",children:["Minggu ke-",v]}),X&&e.jsx("p",{className:"text-xs text-muted-foreground whitespace-nowrap",children:(()=>{const a=new Date(X.tanggal_mulai),r=new Date(X.tanggal_selesai);return`${a.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})} - ${r.toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})}`})()})]}),e.jsx(k,{variant:"outline",size:"sm",onClick:()=>ne(Number(v)+1),disabled:Number(v)>=te.length,children:e.jsx(Ie,{className:"h-4 w-4"})})]}),e.jsxs(oe,{value:ve,onValueChange:Ne,children:[e.jsxs(ce,{className:"grid w-full grid-cols-3",children:[e.jsxs(z,{value:"calendar",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"Kalender"]}),e.jsxs(z,{value:"outgoing",children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"Request Keluar (",F.length,")"]}),e.jsxs(z,{value:"incoming",children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"Request Masuk (",V.length,")"]})]}),e.jsxs(R,{value:"calendar",className:"space-y-4",children:[e.jsx(A,{className:"bg-blue-50 border-blue-200",children:e.jsx(B,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ee,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Cara Tukar Jadwal:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-blue-700",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Klik jadwal Anda"})," yang ingin ditukar/dipindah (ditandai warna hijau)"]}),e.jsxs("li",{children:["Lalu ",e.jsx("strong",{children:"klik jadwal dosen lain"})," untuk tukar jadwal"]}),e.jsxs("li",{children:["Atau ",e.jsx("strong",{children:"klik slot kosong"})," untuk pindah jadwal"]}),e.jsx("li",{children:"Perubahan bersifat sementara (hanya untuk minggu ini)"})]})]})]})})}),d&&e.jsx(A,{className:"bg-green-50 border-green-300",children:e.jsx(B,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(O,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-green-900",children:["Jadwal terpilih: ",d.matkul]}),e.jsxs("p",{className:"text-sm text-green-700",children:[new Date(d.tanggal).toLocaleDateString("id-ID")," â€¢ ",d.waktu_mulai.slice(0,5)," - ",d.waktu_selesai.slice(0,5)]})]})]}),e.jsx(k,{size:"sm",variant:"outline",onClick:()=>K(null),children:"Batal"})]})})}),e.jsxs(oe,{value:fe,onValueChange:be,children:[e.jsx(ce,{className:"grid w-full",style:{gridTemplateColumns:`repeat(${J.length}, 1fr)`},children:J.map(a=>e.jsxs(z,{value:a.kode,children:["Kampus ",a.kode]},a.id))}),J.map(a=>{const r=ge[a.id]||{};return e.jsx(R,{value:a.kode,className:"space-y-4",children:e.jsxs(A,{children:[e.jsx(ae,{children:e.jsxs(se,{children:["Kalender Tukar Jadwal - Kampus"," ",a.nama]})}),e.jsxs(B,{children:[e.jsx("div",{className:"block md:hidden",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"min-w-max",children:e.jsxs("table",{className:"border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"sticky left-0 z-20 w-24 border-r-2 border-r-gray-300 bg-muted p-1 font-semibold shadow-md min-w-[140px]",children:"Jam"}),N.map(n=>{const t=ie(n.tanggal);return e.jsx("th",{className:`border p-2 font-semibold min-w-[160px] md:min-w-0 ${t?"bg-primary/10 ring-2 ring-primary ring-inset":""}`,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:t?"text-primary font-bold":"",children:n.nama}),n.tanggal&&e.jsxs("span",{className:`text-xs ${t?"text-primary font-semibold":"text-muted-foreground"}`,children:[new Date(n.tanggal).toLocaleDateString("id-ID",{day:"2-digit",month:"short"}),t&&" (Hari Ini)"]})]})},n.id)})]})}),e.jsx("tbody",{children:(()=>{const n={};return N.forEach(t=>{n[t.id]=new Set}),f.map((t,I)=>{const b=t.waktu_mulai==="11:45:00"&&t.waktu_selesai==="13:15:00";return e.jsxs("tr",{className:b?"h-16":"h-24",children:[e.jsxs("td",{className:`sticky left-0 z-10 border p-2 text-center font-mono text-xs font-semibold ${b?"bg-muted h-16":"bg-background h-24"}`,children:[t.waktu_mulai.slice(0,5)," - ",t.waktu_selesai.slice(0,5)]}),b?e.jsx("td",{colSpan:N.length,className:"border bg-muted/50 p-4 text-center h-16",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-muted-foreground",children:"ISTIRAHAT"})]})}):N.map(c=>{if(n[c.id].has(t.id))return null;const p=r[v]?.[c.id]?.[t.id]||[];let j=1;if(p.length>0){const s=p.map(l=>{if(l.slot_mulai_id&&l.slot_selesai_id){const u=f.findIndex(m=>m.id===l.slot_mulai_id),i=f.findIndex(m=>m.id===l.slot_selesai_id);if(u!==-1&&i!==-1)return i-u+1}return l.durasi_slot||1});j=Math.max(...s);for(let l=0;l<j;l++){const u=I+l;if(u<f.length){const i=f[u].id;n[c.id].add(i)}}}const S=p.length===0;return e.jsx("td",{className:"h-full border p-0 align-middle",rowSpan:j,style:{height:`${j*6}rem`},children:S?(()=>{const s=new Date,l=420,u=s.getTimezoneOffset(),i=new Date(s.getTime()+(l+u)*60*1e3);i.setHours(0,0,0,0);const m=c.tanggal?new Date(c.tanggal+"T00:00:00"):null;m&&m.setHours(0,0,0,0);const x=m&&m<i,g=d&&!x;return e.jsx("div",{className:`h-24 flex items-center justify-center transition-colors ${x?"bg-muted/30 cursor-not-allowed":g?"cursor-pointer hover:bg-blue-50/50 hover:border-blue-400 border-2 border-dashed border-blue-300 group":"border-2 border-dashed border-gray-300"}`,onClick:()=>{g&&c.tanggal&&P([],c.tanggal,t)},children:x?e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(_,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),e.jsx("div",{className:"text-xs font-medium",children:"Sudah Lewat"})]}):g?e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-6 w-6 mx-auto mb-1 text-blue-600 group-hover:text-blue-700"}),e.jsx("div",{className:"text-sm font-medium text-blue-700 group-hover:text-blue-800",children:"Pindah ke sini"})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:e.jsx("div",{className:"text-xs font-medium",children:"Kosong"})})})})():e.jsx("div",{className:"flex h-full flex-col divide-y",children:p.map((s,l)=>{const i=((Q,W)=>{const $=[{from:"from-blue-50",to:"to-blue-100",border:"border-blue-500",icon:"text-blue-600",text:"text-blue-900",hover:"hover:from-blue-100 hover:to-blue-200"},{from:"from-green-50",to:"to-green-100",border:"border-green-500",icon:"text-green-600",text:"text-green-900",hover:"hover:from-green-100 hover:to-green-200"},{from:"from-purple-50",to:"to-purple-100",border:"border-purple-500",icon:"text-purple-600",text:"text-purple-900",hover:"hover:from-purple-100 hover:to-purple-200"},{from:"from-orange-50",to:"to-orange-100",border:"border-orange-500",icon:"text-orange-600",text:"text-orange-900",hover:"hover:from-orange-100 hover:to-orange-200"},{from:"from-pink-50",to:"to-pink-100",border:"border-pink-500",icon:"text-pink-600",text:"text-pink-900",hover:"hover:from-pink-100 hover:to-pink-200"},{from:"from-teal-50",to:"to-teal-100",border:"border-teal-500",icon:"text-teal-600",text:"text-teal-900",hover:"hover:from-teal-100 hover:to-teal-200"}],Y=Q.split("").reduce((Z,q)=>Z+q.charCodeAt(0),0);return $[(Y+W)%$.length]})(s.dosen,l),m=d?.sesi_jadwal_id===s.sesi_jadwal_id,x=s.status==="booking",g=s.is_my_schedule&&!s.is_past&&!x?!0:d&&!s.is_past&&!x;return e.jsxs("div",{className:`bg-gradient-to-br ${i.from} ${i.to} border-l-4 ${i.border} flex h-full flex-col justify-center p-2 ${g?"cursor-pointer "+i.hover:x?"cursor-not-allowed":""} mx-0.5 my-0.5 rounded-lg shadow-sm transition-all duration-200 ${g?"hover:shadow-md":""} relative ${m?"ring-4 ring-green-400":""} ${s.is_past||x?"opacity-50":""}`,onClick:()=>{s.is_past||x||(s.is_my_schedule?re(s):d&&c.tanggal&&P(p,c.tanggal,t))},children:[e.jsxs("div",{className:"mb-2 flex items-start gap-1.5",children:[e.jsx(me,{className:`h-4 w-4 ${i.icon} mt-0.5 flex-shrink-0`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`font-bold ${i.text} truncate text-xs leading-tight`,children:s.matkul}),e.jsx("div",{className:"mt-0.5 flex items-center gap-1",children:e.jsx(h,{variant:"muted",className:"truncate px-1.5 py-0.5 text-xs font-medium",children:s.kelas})})]})]}),e.jsxs("div",{className:"space-y-0.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(de,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate font-medium",children:s.dosen})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(xe,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate font-medium",children:s.lab})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(_,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{className:"flex-1 font-medium",children:[s.waktu_mulai.slice(0,5)," - ",s.waktu_selesai.slice(0,5)]})]})]}),e.jsxs("div",{className:`mt-1.5 flex items-center justify-between border-t pt-1.5 ${i.border.replace("border-","border-opacity-20 border-")}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(h,{variant:"outline",className:"px-1.5 py-0.5 text-xs font-medium",children:[s.sks," SKS"]}),s.is_swapped&&e.jsx(ee,{className:"h-3 w-3 text-purple-600",title:"Jadwal Ditukar"})]}),e.jsxs("div",{className:"flex gap-1",children:[s.is_active&&!s.is_past&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-yellow-500 text-white hover:bg-yellow-500",children:"Berlangsung"}),s.is_past&&!s.is_active&&e.jsx(h,{variant:"secondary",className:"px-1.5 py-0.5 text-xs font-medium",children:"Sudah Lewat"}),s.status==="booking"&&!s.is_past&&!s.is_active&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-orange-500 hover:bg-orange-500",children:"Booking"}),s.is_my_schedule&&!s.is_past&&!s.is_active&&s.status!=="booking"&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-green-600 hover:bg-green-600",children:"Jadwal Saya"}),s.status==="terjadwal"&&!s.is_past&&!s.is_active&&!s.is_my_schedule&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-blue-500 hover:bg-blue-500",children:"Terjadwal"}),s.status==="selesai"&&e.jsx(h,{variant:"secondary",className:"px-1.5 py-0.5 text-xs font-medium",children:"Selesai"})]})]})]},l)})})},c.id)})]},t.id)})})()})]})})})})}),e.jsx("div",{className:"hidden md:block",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"sticky left-0 z-20 w-24 md:w-32 border bg-muted p-2 font-semibold",children:"Jam"}),N.map(n=>{const t=ie(n.tanggal);return e.jsx("th",{className:`border p-2 font-semibold min-w-[160px] md:min-w-0 ${t?"bg-primary/10 ring-2 ring-primary ring-inset":""}`,children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:t?"text-primary font-bold":"",children:n.nama}),n.tanggal&&e.jsxs("span",{className:`text-xs ${t?"text-primary font-semibold":"text-muted-foreground"}`,children:[new Date(n.tanggal).toLocaleDateString("id-ID",{day:"2-digit",month:"short"}),t&&" (Hari Ini)"]})]})},n.id)})]})}),e.jsx("tbody",{children:(()=>{const n={};return N.forEach(t=>{n[t.id]=new Set}),f.map((t,I)=>{const b=t.waktu_mulai==="11:45:00"&&t.waktu_selesai==="13:15:00";return e.jsxs("tr",{className:b?"h-16":"h-24",children:[e.jsxs("td",{className:`sticky left-0 z-10 border p-2 text-center font-mono text-xs font-semibold ${b?"bg-muted h-16":"bg-background h-24"}`,children:[t.waktu_mulai.slice(0,5)," - ",t.waktu_selesai.slice(0,5)]}),b?e.jsx("td",{colSpan:N.length,className:"border bg-muted/50 p-4 text-center h-16",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-semibold text-muted-foreground",children:"ISTIRAHAT"})]})}):N.map(c=>{if(n[c.id].has(t.id))return null;const p=r[v]?.[c.id]?.[t.id]||[];let j=1;if(p.length>0){const s=p.map(l=>{if(l.slot_mulai_id&&l.slot_selesai_id){const u=f.findIndex(m=>m.id===l.slot_mulai_id),i=f.findIndex(m=>m.id===l.slot_selesai_id);if(u!==-1&&i!==-1)return i-u+1}return l.durasi_slot||1});j=Math.max(...s);for(let l=0;l<j;l++){const u=I+l;if(u<f.length){const i=f[u].id;n[c.id].add(i)}}}const S=p.length===0;return e.jsx("td",{className:"h-full border p-0 align-middle",rowSpan:j,style:{height:`${j*6}rem`},children:S?(()=>{const s=new Date,l=420,u=s.getTimezoneOffset(),i=new Date(s.getTime()+(l+u)*60*1e3);i.setHours(0,0,0,0);const m=c.tanggal?new Date(c.tanggal+"T00:00:00"):null;m&&m.setHours(0,0,0,0);const x=m&&m<i,g=d&&!x;return e.jsx("div",{className:`h-24 flex items-center justify-center transition-colors ${x?"bg-muted/30 cursor-not-allowed":g?"cursor-pointer hover:bg-blue-50/50 hover:border-blue-400 border-2 border-dashed border-blue-300 group":"border-2 border-dashed border-gray-300"}`,onClick:()=>{g&&c.tanggal&&P([],c.tanggal,t)},children:x?e.jsxs("div",{className:"text-center text-muted-foreground",children:[e.jsx(_,{className:"h-5 w-5 mx-auto mb-1 opacity-50"}),e.jsx("div",{className:"text-xs font-medium",children:"Sudah Lewat"})]}):g?e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"h-6 w-6 mx-auto mb-1 text-blue-600 group-hover:text-blue-700"}),e.jsx("div",{className:"text-sm font-medium text-blue-700 group-hover:text-blue-800",children:"Pindah ke sini"})]}):e.jsx("div",{className:"text-center text-muted-foreground",children:e.jsx("div",{className:"text-xs font-medium",children:"Kosong"})})})})():e.jsx("div",{className:"flex h-full flex-col divide-y",children:p.map((s,l)=>{const i=((Q,W)=>{const $=[{from:"from-blue-50",to:"to-blue-100",border:"border-blue-500",icon:"text-blue-600",text:"text-blue-900",hover:"hover:from-blue-100 hover:to-blue-200"},{from:"from-green-50",to:"to-green-100",border:"border-green-500",icon:"text-green-600",text:"text-green-900",hover:"hover:from-green-100 hover:to-green-200"},{from:"from-purple-50",to:"to-purple-100",border:"border-purple-500",icon:"text-purple-600",text:"text-purple-900",hover:"hover:from-purple-100 hover:to-purple-200"},{from:"from-orange-50",to:"to-orange-100",border:"border-orange-500",icon:"text-orange-600",text:"text-orange-900",hover:"hover:from-orange-100 hover:to-orange-200"},{from:"from-pink-50",to:"to-pink-100",border:"border-pink-500",icon:"text-pink-600",text:"text-pink-900",hover:"hover:from-pink-100 hover:to-pink-200"},{from:"from-teal-50",to:"to-teal-100",border:"border-teal-500",icon:"text-teal-600",text:"text-teal-900",hover:"hover:from-teal-100 hover:to-teal-200"}],Y=Q.split("").reduce((Z,q)=>Z+q.charCodeAt(0),0);return $[(Y+W)%$.length]})(s.dosen,l),m=d?.sesi_jadwal_id===s.sesi_jadwal_id,x=s.status==="booking",g=s.is_my_schedule&&!s.is_past&&!x?!0:d&&!s.is_past&&!x;return e.jsxs("div",{className:`bg-gradient-to-br ${i.from} ${i.to} border-l-4 ${i.border} flex h-full flex-col justify-center p-2 ${g?"cursor-pointer "+i.hover:x?"cursor-not-allowed":""} mx-0.5 my-0.5 rounded-lg shadow-sm transition-all duration-200 ${g?"hover:shadow-md":""} relative ${m?"ring-4 ring-green-400":""} ${s.is_past||x?"opacity-50":""}`,onClick:()=>{s.is_past||x||(s.is_my_schedule?re(s):d&&c.tanggal&&P(p,c.tanggal,t))},children:[e.jsxs("div",{className:"mb-2 flex items-start gap-1.5",children:[e.jsx(me,{className:`h-4 w-4 ${i.icon} mt-0.5 flex-shrink-0`}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`font-bold ${i.text} truncate text-xs leading-tight`,children:s.matkul}),e.jsx("div",{className:"mt-0.5 flex items-center gap-1",children:e.jsx(h,{variant:"muted",className:"truncate px-1.5 py-0.5 text-xs font-medium",children:s.kelas})})]})]}),e.jsxs("div",{className:"space-y-0.5 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(de,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate font-medium",children:s.dosen})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(xe,{className:"h-3 w-3 flex-shrink-0"}),e.jsx("span",{className:"flex-1 truncate font-medium",children:s.lab})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-700",children:[e.jsx(_,{className:"h-3 w-3 flex-shrink-0"}),e.jsxs("span",{className:"flex-1 font-medium",children:[s.waktu_mulai.slice(0,5)," - ",s.waktu_selesai.slice(0,5)]})]})]}),e.jsxs("div",{className:`mt-1.5 flex items-center justify-between border-t pt-1.5 ${i.border.replace("border-","border-opacity-20 border-")}`,children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(h,{variant:"outline",className:"px-1.5 py-0.5 text-xs font-medium",children:[s.sks," SKS"]}),s.is_swapped&&e.jsx(ee,{className:"h-3 w-3 text-purple-600",title:"Jadwal Ditukar"})]}),e.jsxs("div",{className:"flex gap-1",children:[s.is_active&&!s.is_past&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-yellow-500 text-white hover:bg-yellow-500",children:"Berlangsung"}),s.is_past&&!s.is_active&&e.jsx(h,{variant:"secondary",className:"px-1.5 py-0.5 text-xs font-medium",children:"Sudah Lewat"}),s.status==="booking"&&!s.is_past&&!s.is_active&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-orange-500 hover:bg-orange-500",children:"Booking"}),s.is_my_schedule&&!s.is_past&&!s.is_active&&s.status!=="booking"&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-green-600 hover:bg-green-600",children:"Jadwal Saya"}),s.status==="terjadwal"&&!s.is_past&&!s.is_active&&!s.is_my_schedule&&e.jsx(h,{variant:"default",className:"px-1.5 py-0.5 text-xs font-medium bg-blue-500 hover:bg-blue-500",children:"Terjadwal"}),s.status==="selesai"&&e.jsx(h,{variant:"secondary",className:"px-1.5 py-0.5 text-xs font-medium",children:"Selesai"})]})]})]},l)})})},c.id)})]},t.id)})})()})]})})})]})]})},a.id)})]})]}),e.jsx(R,{value:"outgoing",className:"space-y-4",children:e.jsxs(A,{children:[e.jsx(ae,{children:e.jsx(se,{children:"Request Tukar Jadwal yang Saya Ajukan"})}),e.jsx(B,{children:F.length>0?e.jsx("div",{className:"space-y-3",children:F.map(a=>e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[le(a.status),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(a.tanggal_diajukan).toLocaleDateString("id-ID")})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Jadwal Saya:"}),e.jsxs("div",{className:"text-sm space-y-1 bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-medium",children:a.sesi_pemohon.mata_kuliah}),e.jsxs("p",{children:[a.sesi_pemohon.hari,", ",new Date(a.sesi_pemohon.tanggal).toLocaleDateString("id-ID")]}),e.jsxs("p",{children:[a.sesi_pemohon.waktu_mulai," - ",a.sesi_pemohon.waktu_selesai]}),e.jsx("p",{children:a.sesi_pemohon.laboratorium})]})]}),a.sesi_mitra?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Ditukar dengan:"}),e.jsxs("div",{className:"text-sm space-y-1 bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-medium",children:a.sesi_mitra.mata_kuliah}),e.jsxs("p",{children:["Dosen: ",a.mitra?.nama]}),e.jsxs("p",{children:[a.sesi_mitra.hari,", ",new Date(a.sesi_mitra.tanggal).toLocaleDateString("id-ID")]}),e.jsxs("p",{children:[a.sesi_mitra.waktu_mulai," - ",a.sesi_mitra.waktu_selesai]}),e.jsx("p",{children:a.sesi_mitra.laboratorium})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Pindah ke:"}),e.jsxs("div",{className:"text-sm space-y-1 bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-medium",children:"Slot Kosong"}),e.jsx("p",{className:"text-muted-foreground",children:"Request pindah jadwal ke waktu lain"})]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Alasan: "}),e.jsx("span",{children:a.alasan_pemohon})]}),a.alasan_penolakan&&e.jsxs("div",{className:"text-sm bg-destructive/10 p-3 rounded border border-destructive/20",children:[e.jsx("span",{className:"font-medium text-destructive",children:"Alasan Penolakan: "}),e.jsx("span",{children:a.alasan_penolakan})]}),a.status==="menunggu"&&e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{size:"sm",variant:"outline",onClick:()=>De(a.id),children:"Batalkan"})})]})},a.id))}):e.jsx("div",{className:"py-12 text-center text-muted-foreground",children:"Belum ada request tukar jadwal yang diajukan"})})]})}),e.jsx(R,{value:"incoming",className:"space-y-4",children:e.jsxs(A,{children:[e.jsx(ae,{children:e.jsx(se,{children:"Request Tukar Jadwal dari Dosen Lain"})}),e.jsx(B,{children:V.length>0?e.jsx("div",{className:"space-y-3",children:V.map(a=>{const[r,n]=w.useState("");return e.jsx("div",{className:"rounded-lg border p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[le(a.status),e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(a.tanggal_diajukan).toLocaleDateString("id-ID")})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Jadwal Saya:"}),e.jsxs("div",{className:"text-sm space-y-1 bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-medium",children:a.sesi_mitra?.mata_kuliah}),e.jsxs("p",{children:[a.sesi_mitra?.hari,", ",a.sesi_mitra&&new Date(a.sesi_mitra.tanggal).toLocaleDateString("id-ID")]}),e.jsxs("p",{children:[a.sesi_mitra?.waktu_mulai," - ",a.sesi_mitra?.waktu_selesai]}),e.jsx("p",{children:a.sesi_mitra?.laboratorium})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Ditukar dengan:"}),e.jsxs("div",{className:"text-sm space-y-1 bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-medium",children:a.sesi_pemohon.mata_kuliah}),e.jsxs("p",{children:["Dosen: ",a.pemohon.nama]}),e.jsxs("p",{children:[a.sesi_pemohon.hari,", ",new Date(a.sesi_pemohon.tanggal).toLocaleDateString("id-ID")]}),e.jsxs("p",{children:[a.sesi_pemohon.waktu_mulai," - ",a.sesi_pemohon.waktu_selesai]}),e.jsx("p",{children:a.sesi_pemohon.laboratorium})]})]})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Alasan: "}),e.jsx("span",{children:a.alasan_pemohon})]}),a.status==="menunggu"&&e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{size:"sm",onClick:()=>ye(a.id),children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Setujui"]}),e.jsxs(k,{size:"sm",variant:"destructive",onClick:()=>{const t=prompt("Alasan penolakan:");t&&Se(a.id,t)},children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Tolak"]})]})})]})},a.id)})}):e.jsx("div",{className:"py-12 text-center text-muted-foreground",children:"Belum ada request tukar jadwal masuk"})})]})})]})]}),e.jsx($e,{open:we,onOpenChange:E,children:e.jsxs(Ae,{children:[e.jsxs(Be,{children:[e.jsx(Le,{children:o?.isEmptySlot?"Pindah Jadwal":"Tukar Jadwal"}),e.jsx(Je,{children:o?.isEmptySlot?"Ajukan permintaan pindah jadwal ke slot kosong":"Ajukan permintaan tukar jadwal dengan dosen lain"})]}),d&&o&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"font-semibold",children:"Jadwal Anda:"}),e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-3 space-y-1 text-sm",children:[e.jsx("p",{className:"font-medium",children:d.matkul}),e.jsx("p",{children:new Date(d.tanggal).toLocaleDateString("id-ID")}),e.jsxs("p",{children:[d.waktu_mulai.slice(0,5)," - ",d.waktu_selesai.slice(0,5)]}),e.jsx("p",{children:d.lab})]})]}),!o.isEmptySlot&&o.cell?e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"font-semibold",children:"Ditukar dengan:"}),e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-3 space-y-1 text-sm",children:[e.jsx("p",{className:"font-medium",children:o.cell.matkul}),e.jsxs("p",{children:["Dosen: ",o.cell.dosen]}),e.jsx("p",{children:new Date(o.tanggal).toLocaleDateString("id-ID")}),e.jsxs("p",{children:[o.slot.waktu_mulai.slice(0,5)," - ",o.slot.waktu_selesai.slice(0,5)]}),e.jsx("p",{children:o.cell.lab})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(H,{className:"font-semibold",children:"Pindah ke:"}),e.jsxs("div",{className:"rounded-lg border bg-muted/50 p-3 space-y-1 text-sm",children:[e.jsx("p",{className:"font-medium",children:"Slot Kosong"}),e.jsx("p",{children:new Date(o.tanggal).toLocaleDateString("id-ID")}),e.jsxs("p",{children:[o.slot.waktu_mulai.slice(0,5)," - ",o.slot.waktu_selesai.slice(0,5)]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(H,{htmlFor:"alasan",children:["Alasan ",o.isEmptySlot?"Pindah":"Tukar"," ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(Me,{id:"alasan",placeholder:"Masukkan alasan...",rows:3,value:T.alasan,onChange:a=>U({...T,alasan:a.target.value})})]})]}),e.jsxs(Ee,{children:[e.jsx(k,{variant:"outline",onClick:()=>{E(!1),K(null),G(null)},children:"Batal"}),e.jsxs(k,{onClick:_e,disabled:!T.alasan.trim(),children:["Ajukan ",o?.isEmptySlot?"Pindah":"Tukar"]})]})]})})]})}export{_a as default};
